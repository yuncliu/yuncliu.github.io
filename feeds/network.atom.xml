<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Yuncheng Liu's Blog</title><link href="https://yuncliu.github.io/" rel="alternate"></link><link href="https://yuncliu.github.io/feeds/network.atom.xml" rel="self"></link><id>https://yuncliu.github.io/</id><updated>2015-09-23T16:01:38+08:00</updated><entry><title>TCP Seq and Ack</title><link href="https://yuncliu.github.io/tcp-seq-and-ack.html" rel="alternate"></link><published>2015-09-23T16:01:38+08:00</published><author><name>yuncliu</name></author><id>tag:yuncliu.github.io,2015-09-23:tcp-seq-and-ack.html</id><summary type="html">&lt;p&gt;&lt;strong&gt;Sequence&lt;/strong&gt; and &lt;strong&gt;Acknowlegement&lt;/strong&gt; number is very import in TCP protocol. 
They are used to detect if the packet is out of order or if there are any missing pakcets.
The &lt;strong&gt;Seq&lt;/strong&gt; in the &lt;strong&gt;SYN&lt;/strong&gt; packet is called &lt;strong&gt;ISN&lt;/strong&gt;(Initial Sequence Number)&lt;/p&gt;
&lt;p&gt;Wireshark will calculate relative sequence nuber = real Seq - ISN&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;1.  &lt;span class="m"&gt;36724&lt;/span&gt; &amp;gt; &lt;span class="m"&gt;9999&lt;/span&gt;  &lt;span class="o"&gt;[&lt;/span&gt;SYN&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43690&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
    &lt;span class="m"&gt;36724&lt;/span&gt; send a TCP header with SYN flag to 9999, &lt;span class="nv"&gt;ISN&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 0. try to establish a TCP connection

2.  &lt;span class="m"&gt;9999&lt;/span&gt;  &amp;gt; &lt;span class="m"&gt;36724&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;SYN, ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43690&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
    &lt;span class="m"&gt;9999&lt;/span&gt; reply with SYN flag and &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; ISN,  &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;ISN + 1&lt;span class="o"&gt;)&lt;/span&gt;

3.  &lt;span class="m"&gt;36724&lt;/span&gt; &amp;gt; &lt;span class="m"&gt;9999&lt;/span&gt;  &lt;span class="o"&gt;[&lt;/span&gt;ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
    &lt;span class="m"&gt;36724&lt;/span&gt; send with  &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; ISN + 1, &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; ISN + 1.  
    TCP connection is estableshed 

4.  &lt;span class="m"&gt;36724&lt;/span&gt; &amp;gt; &lt;span class="m"&gt;9999&lt;/span&gt;  &lt;span class="o"&gt;[&lt;/span&gt;PSH, ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;3
    &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;ISN&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; 1
    &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;3&lt;span class="o"&gt;)&lt;/span&gt;.Ack &lt;span class="o"&gt;=&lt;/span&gt; 1

5.  &lt;span class="m"&gt;9999&lt;/span&gt;  &amp;gt; &lt;span class="m"&gt;36724&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
    &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;ISN&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; 1
    &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; + &lt;span class="nv"&gt;3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 4

6.  &lt;span class="m"&gt;9999&lt;/span&gt;  &amp;gt; &lt;span class="m"&gt;36724&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;PSH, ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;3
    &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;5&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;5&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; + &lt;span class="nv"&gt;0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;          Packet&lt;span class="o"&gt;(&lt;/span&gt;5&lt;span class="o"&gt;)&lt;/span&gt; is last packet sent from &lt;span class="m"&gt;9999&lt;/span&gt; to 36724
    &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;5&lt;span class="o"&gt;)&lt;/span&gt;.Ack &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;  Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt; is latest packet received from 36724

7.  &lt;span class="m"&gt;36724&lt;/span&gt; &amp;gt; &lt;span class="m"&gt;9999&lt;/span&gt;  &lt;span class="o"&gt;[&lt;/span&gt;ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;0
    &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; + &lt;span class="nv"&gt;3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;    Packet&lt;span class="o"&gt;(&lt;/span&gt;4&lt;span class="o"&gt;)&lt;/span&gt; is last packet sent from &lt;span class="m"&gt;36723&lt;/span&gt; to 9999
    &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;6&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;6&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; + &lt;span class="nv"&gt;3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 4

8.  &lt;span class="m"&gt;36724&lt;/span&gt; &amp;gt; &lt;span class="m"&gt;9999&lt;/span&gt;  &lt;span class="o"&gt;[&lt;/span&gt;PSH, ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;4
    &lt;span class="nv"&gt;Seq&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;7&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;7&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; + &lt;span class="nv"&gt;0&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;                   Packet&lt;span class="o"&gt;(&lt;/span&gt;7&lt;span class="o"&gt;)&lt;/span&gt; is last packet sent from &lt;span class="m"&gt;36724&lt;/span&gt; to 9999
    &lt;span class="nv"&gt;Ack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;7&lt;span class="o"&gt;)&lt;/span&gt;.Ack &lt;span class="o"&gt;=&lt;/span&gt; Packet&lt;span class="o"&gt;(&lt;/span&gt;6&lt;span class="o"&gt;)&lt;/span&gt;.Seq + Packet&lt;span class="o"&gt;(&lt;/span&gt;6&lt;span class="o"&gt;)&lt;/span&gt;.Len &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; + &lt;span class="nv"&gt;3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt;   Packet&lt;span class="o"&gt;(&lt;/span&gt;6&lt;span class="o"&gt;)&lt;/span&gt; is latest packet received from 9999

9.  &lt;span class="m"&gt;9999&lt;/span&gt;  &amp;gt; &lt;span class="m"&gt;36724&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;PSH, ACK&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="nv"&gt;Seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;? &lt;span class="nv"&gt;Ack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;? &lt;span class="nv"&gt;Win&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;43776&lt;/span&gt; &lt;span class="nv"&gt;Len&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;4
    So &lt;span class="k"&gt;do&lt;/span&gt; you know here the Seq and Ack ?
    Seq is related with packet &lt;span class="m"&gt;6&lt;/span&gt; and Ack is related with pakcet 8
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So, the &lt;strong&gt;relative Seq&lt;/strong&gt; can reflect how many bytes is already sent, and &lt;strong&gt;relative Ack&lt;/strong&gt; could reflect 
how many bytes is already received.&lt;/p&gt;</summary><category term="network"></category></entry><entry><title>"iptables example"</title><link href="https://yuncliu.github.io/iptables-example.html" rel="alternate"></link><published>2015-05-20T16:45:50+08:00</published><author><name>yuncliu</name></author><id>tag:yuncliu.github.io,2015-05-20:iptables-example.html</id><summary type="html">&lt;ul&gt;
&lt;li&gt;block output sctp packet&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;iptables -A OUTPUT -p sctp -s 192.168.166.250 -d 192.168.165.86  -j DROP
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;block COOKIE_ECHO of sctp&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;iptables  -A INPUT -i lo -p sctp --dport &lt;span class="m"&gt;10000&lt;/span&gt; --chunk-types  ALL COOKIE_ECHO -j DROP
&lt;/pre&gt;&lt;/div&gt;</summary><category term="network"></category><category term="linux"></category></entry></feed>